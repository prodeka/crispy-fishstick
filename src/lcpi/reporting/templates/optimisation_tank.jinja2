<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <title>Rapport d'Optimisation V11</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 24px; color: #333; }
    h1, h2, h3 { color: #2c3e50; }
    table { border-collapse: collapse; width: 100%; margin: 20px 0; box-shadow: 0 2px 3px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f2f2f2; font-weight: bold; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    .section { margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; }
    .card { background-color: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .meta-info { font-size: 0.9em; color: #777; }
  </style>
</head>
<body>

  <div class="card">
    <h1>Rapport d'Optimisation de Réseau AEP (V11)</h1>
    <p class="meta-info">Généré le: {{ "now" | strftime("%d/%m/%Y %H:%M") }}</p>
    <p>Ce rapport présente les résultats de l'optimisation multi-objectifs pour le réseau <strong>{{ metadata.network_file }}</strong> en utilisant la méthode <strong>{{ metadata.method }}</strong>.</p>
  </div>

  <div class="section">
    <h2>Synthèse des Propositions</h2>
    <p>Le tableau suivant compare les solutions optimales identifiées.</p>
    <table>
      <thead>
        <tr>
          <th>Proposition</th>
          <th>Faisable</th>
          <th>CAPEX (FCFA)</th>
          <th>OPEX (NPV, FCFA)</th>
          <th>Hauteurs Réservoirs (m)</th>
        </tr>
      </thead>
      <tbody>
        {% for prop in proposals %}
        <tr>
          <td><strong>{{ prop.name }}</strong></td>
          <td>{{ 'Oui' if prop.is_feasible else 'Non' }}</td>
          <td>{{ "{:,.0f}".format(prop.costs.capex) if prop.costs.capex is not none else 'N/A' }}</td>
          <td>{{ "{:,.0f}".format(prop.costs.opex_npv) if prop.costs.opex_npv is not none else 'N/A' }}</td>
          <td>{{ prop.tanks | map(attribute='H_m') | join(', ') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% for prop in proposals %}
  <div class="section">
    <h3>Détails de la Proposition: {{ prop.name }}</h3>
    <h4>Diamètres Optimaux (mm)</h4>
    <table>
      <thead><tr><th>Conduite</th><th>Diamètre (mm)</th></tr></thead>
      <tbody>
        {% for link_id, dn in prop.diameters_mm.items() %}
          <tr><td>{{ link_id }}</td><td>{{ dn }}</td></tr>
        {% else %}
          <tr><td colspan="2">Aucun diamètre spécifié.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endfor %}

  {% if pareto_front %}
  <div class="section">
    <h2>Front de Pareto</h2>
    <p>Ensemble des solutions non-dominées trouvées par l'algorithme.</p>
    <table>
      <thead>
        <tr>
          <th>CAPEX (FCFA)</th>
          <th>OPEX (NPV, FCFA)</th>
        </tr>
      </thead>
      <tbody>
        {% for point in pareto_front %}
        <tr>
          <td>{{ "{:,.0f}".format(point.costs.capex) }}</td>
          <td>{{ "{:,.0f}".format(point.costs.opex_npv) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

</body>
</html>

